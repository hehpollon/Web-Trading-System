<!DOCTYPE html>
<html style="height: 100%;">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="shortcut icon" href="src/assets/favicon.ico" type="image/x-icon">
  <link rel="icon" href="src/assets/favicon.ico" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
  <script src="https://unpkg.com/vue/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue-localstorage@0.6.1/dist/vue-local-storage.min.js"></script>
  <title>STS</title>
</head>

  <body style="height: 90%;" v-cloak>
    <div id="app" style="height: 80%;">
      <div class="stockName stitle">
        {{ stockName }}
        {{ curpr }}
      </div>
      <div>
      </div>
      <table class="table">
        <tbody style="height: 80%;">
          <tr>
            <th class="sell">건수</th>
            <th class="sell">잔량</th>
            <th class="stitle">{{ hours }}:{{ minutes }}:{{ seconds }}</th>
            <th class="buy">잔량</th>
            <th class="buy">건수</th>
          </tr>
          <tr align="center">
            <td bgcolor="#0000FF" colspan="2">
              <font color="white">시장가매도</font>
            </td>
            <td bgcolor="#ffffff" class="stitle">시장가</td>
            <td bgcolor="#FF0000" colspan="2">
              <font color="white">시장가매수</font>
            </td>
          </tr>
          <tr align="right" class="sell">
            <td class="sBackground">{{snum5}}</td>
            <td class="sBackground">{{sbal5}}</td>
            <td class="sBackground spr">{{spr5}}</td>
            <td class="snBackground"></td>
            <td class="snBackground"></td>
          </tr>
          <tr align="right" class="sell">
            <td class="sBackground">{{snum4}}</td>
            <td class="sBackground">{{sbal4}}</td>
            <td class="sBackground spr">{{spr4}}</td>
            <td class="snBackground"></td>
            <td class="snBackground"></td>
          </tr>
          <tr align="right" class="sell">
            <td class="sBackground">{{snum3}}</td>
            <td class="sBackground">{{sbal3}}</td>
            <td class="sBackground spr">{{spr3}}</td>
            <td class="snBackground"></td>
            <td class="snBackground"></td>
          </tr>
          <tr align="right" class="sell">
            <td class="sBackground">{{snum2}}</td>
            <td class="sBackground">{{sbal2}}</td>
            <td class="sBackground spr">{{spr2}}</td>
            <td class="snBackground"></td>
            <td class="snBackground"></td>
          </tr>
          <tr align="right" class="sell">
            <td class="sBackground">{{snum1}}</td>
            <td class="sBackground">{{sbal1}}</td>
            <td class="sBackground spr">{{spr1}}</td>
            <td class="snBackground"></td>
            <td class="snBackground"></td>
          </tr>
          <tr align="right" class="buy">
            <td class="bnBackground"></td>
            <td class="bnBackground"></td>
            <td class="bBackground bpr">{{bpr1}}</td>
            <td class="bBackground">{{bbal1}}</td>
            <td class="bBackground">{{bnum1}}</td>
          </tr>
          <tr align="right" class="buy">
            <td class="bnBackground"></td>
            <td class="bnBackground"></td>
            <td class="bBackground bpr">{{bpr2}}</td>
            <td class="bBackground">{{bbal2}}</td>
            <td class="bBackground">{{bnum2}}</td>
          </tr>
          <tr align="right" class="buy">
            <td class="bnBackground"></td>
            <td class="bnBackground"></td>
            <td class="bBackground bpr">{{bpr3}}</td>
            <td class="bBackground">{{bbal3}}</td>
            <td class="bBackground">{{bnum3}}</td>
          </tr>
          <tr align="right" class="buy">
            <td class="bnBackground"></td>
            <td class="bnBackground"></td>
            <td class="bBackground bpr">{{bpr4}}</td>
            <td class="bBackground">{{bbal4}}</td>
            <td class="bBackground">{{bnum4}}</td>
          </tr>
          <tr align="right" class="buy">
            <td class="bnBackground"></td>
            <td class="bnBackground"></td>
            <td class="bBackground bpr">{{bpr5}}</td>
            <td class="bBackground">{{bbal5}}</td>
            <td class="bBackground">{{bnum5}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </body>

<script>
  var getParam = function(key){
    var _parammap = {};
    document.location.search.replace(/\??(?:([^=]+)=([^&]*)&?)/g, function () {
      function decode(s) {
        return decodeURIComponent(s.split("+").join(" "));
      }

      _parammap[decode(arguments[1])] = decode(arguments[2]);
    });

    return _parammap[key];
  };

  function getHourTime (h) {
    return h >= 12 ? 'PM' : 'AM'
  }

  function getZeroPad (n) {
    return (parseInt(n, 10) >= 10 ? '' : '0') + n
  }

  //세번째 자리 콤마
function comma(rawNum){
   var len, point, str;

   var num = rawNum.split(".")[0]
   var fnum = rawNum.split(".")[1]
   num = num + "";
   point = num.length % 3 ;
   len = num.length;

   str = num.substring(0, point);
   while (point < len) {
      if (str != "") str += ",";
      str += num.substring(point, point + 3);
      point += 3;
   }
   if (fnum != undefined && fnum.length > 0) {
     str = str + "." + fnum
   }

   return str;
}



var app = new Vue({
        el: '#app',
        data: {
          name: 'Vue',
          stockName: getParam("name"),
          hours: new Date().getHours() % 12 || 12,
          minutes: getZeroPad(new Date().getMinutes()),
          seconds: getZeroPad(new Date().getSeconds()),
          hourtime: '',
          tdata:'0',
          spr1:'0',
          sbal1:'0',
          snum1:'0',
          spr2:'0',
          sbal2:'0',
          snum2:'0',
          spr3:'0',
          sbal3:'0',
          snum3:'0',
          spr4:'0',
          sbal4:'0',
          snum4:'0',
          spr5:'0',
          sbal5:'0',
          snum5:'0',
          bpr1:'0',
          bbal1:'0',
          bnum1:'0',
          bpr2:'0',
          bbal2:'0',
          bnum2:'0',
          bpr3:'0',
          bbal3:'0',
          bnum3:'0',
          bpr4:'0',
          bbal4:'0',
          bnum4:'0',
          bpr5:'0',
          bbal5:'0',
          bnum5:'0',
          curpr:'0'
        },
        mounted () {
          setInterval(this.updateDateTime, 100);
          this.listenStorage()
        },
        ready: function() {
          
        },
        computed: {
          currentTime: function () {
            return Date.now()
          }
        },
        methods: {
          updateDateTime () {
            let now = new Date()
            this.hours = now.getHours()
            this.minutes = getZeroPad(now.getMinutes())
            this.seconds = getZeroPad(now.getSeconds())
            this.hourtime = getHourTime(this.hours)
            this.hours = this.hours % 12 || 12
          },
          listenStorage () {
            var vm = this;
            window.addEventListener('storage', function(e) { 
              if(e.key == "q_"+vm.stockName) {
                var jdata = JSON.parse(e.newValue);
                vm.spr1 = jdata["매도1단계우선호가가격"];
                vm.sbal1 = jdata["매도1단계우선호가잔량"];
                vm.snum1 = jdata["매도1단계우선호가건수"];
                vm.spr2 = jdata["매도2단계우선호가가격"];
                vm.sbal2 = jdata["매도2단계우선호가잔량"];
                vm.snum2 = jdata["매도2단계우선호가건수"];
                vm.spr3 = jdata["매도3단계우선호가가격"];
                vm.sbal3 = jdata["매도3단계우선호가잔량"];
                vm.snum3 = jdata["매도3단계우선호가건수"];
                vm.spr4 = jdata["매도4단계우선호가가격"];
                vm.sbal4 = jdata["매도4단계우선호가잔량"];
                vm.snum4 = jdata["매도4단계우선호가건수"];
                vm.spr5 = jdata["매도5단계우선호가가격"];
                vm.sbal5 = jdata["매도5단계우선호가잔량"];
                vm.snum5 = jdata["매도5단계우선호가건수"];

                vm.bpr1 = jdata["매수1단계우선호가가격"];
                vm.bbal1 = jdata["매수1단계우선호가잔량"];
                vm.bnum1 = jdata["매수1단계우선호가건수"];
                vm.bpr2 = jdata["매수2단계우선호가가격"];
                vm.bbal2 = jdata["매수2단계우선호가잔량"];
                vm.bnum2 = jdata["매수2단계우선호가건수"];
                vm.bpr3 = jdata["매수3단계우선호가가격"];
                vm.bbal3 = jdata["매수3단계우선호가잔량"];
                vm.bnum3 = jdata["매수3단계우선호가건수"];
                vm.bpr4 = jdata["매수4단계우선호가가격"];
                vm.bbal4 = jdata["매수4단계우선호가잔량"];
                vm.bnum4 = jdata["매수4단계우선호가건수"];
                vm.bpr5 = jdata["매수5단계우선호가가격"];
                vm.bbal5 = jdata["매수5단계우선호가잔량"];
                vm.bnum5 = jdata["매수5단계우선호가건수"];

                vm.spr1 = comma(vm.spr1)
                vm.spr2 = comma(vm.spr2)
                vm.spr3 = comma(vm.spr3)
                vm.spr4 = comma(vm.spr4)
                vm.spr5 = comma(vm.spr5)

                vm.bpr1 = comma(vm.bpr1)
                vm.bpr2 = comma(vm.bpr2)
                vm.bpr3 = comma(vm.bpr3)
                vm.bpr4 = comma(vm.bpr4)
                vm.bpr5 = comma(vm.bpr5)


              } else if(e.key == "t_"+vm.stockName) {
                var jdata = JSON.parse(e.newValue);
                vm.curpr = jdata["현재가"];
              }
            });
          }
        }
      })

</script>


<style>
    table,
    th,
    td {
      border: 1px solid #ffffff;
    }
    .stockName {
      padding: 5px;
    }
    body {
     background-color: #F6F6F8;
   }
   .table {
      width: 100%;
      height: 100%;
   }
   #app {
    height: 100%;
   }
   .buy {
    color: #E6050A;
   }
   .bpr {
    font-weight: bold;
   }
   .sell {
     color: #0D46C8;
   }
   .spr{
    font-weight: bold;
   }
   .bBackground {
    background-color: #ffeff4;
   }
   .sBackground {
    background-color: #e0f1ff;
   }
   .snBackground {
    background-color: #ffffff;
   }
   .bnBackground {
    background-color: #ffffff;
   }
   .stext {
    color: #666666;
   }
   .stitle {
     color: #333333;
   }
  </style>

</html>